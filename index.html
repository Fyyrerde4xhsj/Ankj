<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BrainForge ‚Äì IQ Training Lab</title>
    <!-- Unity Ads SDK -->
    <script src="https://api.unityads.unity3d.com/ads/v1/unityads.js"></script>
    <style>
        :root {
            --bg: #0f172a;
            --card: #1e293b;
            --primary: #3b82f6;
            --accent: #10b981;
            --text: #f8fafc;
            --text-dim: #94a3b8;
            --danger: #ef4444;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Roboto, sans-serif; }
        body { background: var(--bg); color: var(--text); overflow: hidden; touch-action: manipulation; }

        /* Layout */
        #app { height: 100vh; display: flex; flex-direction: column; }
        header { padding: 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #334155; }
        .stats-bar { display: flex; gap: 15px; font-size: 0.9rem; }
        .stat-item { background: var(--card); padding: 5px 12px; border-radius: 20px; border: 1px solid #334155; }

        /* Screens */
        .screen { flex: 1; display: none; padding: 20px; overflow-y: auto; }
        .screen.active { display: flex; flex-direction: column; }

        /* Dashboard */
        .iq-card { background: linear-gradient(135deg, #3b82f6, #8b5cf6); padding: 30px; border-radius: 24px; text-align: center; margin-bottom: 25px; box-shadow: 0 10px 25px -5px rgba(0,0,0,0.3); }
        .iq-value { font-size: 3.5rem; font-weight: 800; }
        .iq-label { font-size: 1.1rem; opacity: 0.9; }

        .game-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .game-card { background: var(--card); padding: 20px; border-radius: 16px; border: 1px solid #334155; text-align: center; transition: 0.2s; position: relative; overflow: hidden; }
        .game-card:active { transform: scale(0.95); background: #334155; }
        .game-icon { font-size: 2rem; margin-bottom: 8px; display: block; }
        .game-title { font-weight: 600; font-size: 0.9rem; }

        /* Game UI */
        #game-container { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .timer-bar { width: 100%; height: 6px; background: #334155; border-radius: 3px; margin-bottom: 20px; overflow: hidden; }
        #timer-fill { width: 100%; height: 100%; background: var(--primary); transition: width 0.1s linear; }
        .question-area { width: 100%; text-align: center; margin-bottom: 30px; }
        
        /* Specific Game Elements */
        .grid-container { display: grid; gap: 8px; margin: 0 auto; }
        .grid-tile { background: var(--card); border: 1px solid #334155; border-radius: 8px; aspect-ratio: 1; transition: 0.2s; }
        .grid-tile.active { background: var(--primary); }
        .grid-tile.correct { background: var(--accent); }
        .grid-tile.wrong { background: var(--danger); }

        .choice-btn { background: var(--card); border: 1px solid #334155; color: white; padding: 15px; margin: 5px; border-radius: 12px; font-size: 1.2rem; width: 100%; }
        .choice-btn:active { background: var(--primary); }

        /* Feedback Overlays */
        #feedback { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 4rem; pointer-events: none; z-index: 100; opacity: 0; }
        @keyframes pop { 0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); } 50% { opacity: 1; } 100% { opacity: 0; transform: translate(-50%, -50%) scale(1.5); } }

        /* Utilities */
        .hidden { display: none !important; }
        .btn-main { background: var(--primary); color: white; border: none; padding: 15px 30px; border-radius: 12px; font-weight: bold; font-size: 1rem; width: 100%; margin-top: 20px; }
    </style>
</head>
<body>

    <div id="app">
        <header>
            <div class="brand" onclick="app.showDashboard()"><strong>BrainForge</strong></div>
            <div class="stats-bar">
                <div class="stat-item">XP: <span id="xp-val">0</span></div>
                <div class="stat-item">üî• <span id="streak-val">0</span></div>
            </div>
        </header>

        <!-- Dashboard -->
        <div id="dashboard" class="screen active">
            <div class="iq-card">
                <div class="iq-label">Estimated IQ</div>
                <div class="iq-value" id="iq-display">--</div>
                <div class="iq-label" id="rank-display">Beginner</div>
            </div>

            <div class="game-grid">
                <div class="game-card" onclick="app.startGame('pattern')">
                    <span class="game-icon">üß©</span>
                    <div class="game-title">Pattern Master</div>
                </div>
                <div class="game-card" onclick="app.startGame('memory')">
                    <span class="game-icon">üß†</span>
                    <div class="game-title">Memory Grid</div>
                </div>
                <div class="game-card" onclick="app.startGame('math')">
                    <span class="game-icon">üî¢</span>
                    <div class="game-title">Math Rush</div>
                </div>
                <div class="game-card" onclick="app.startGame('logic')">
                    <span class="game-icon">üîê</span>
                    <div class="game-title">Logic Lock</div>
                </div>
                <div class="game-card" onclick="app.startGame('odd')">
                    <span class="game-icon">ü¶Ñ</span>
                    <div class="game-title">Odd One Out</div>
                </div>
                <div class="game-card" onclick="app.startGame('reverse')">
                    <span class="game-icon">üîÑ</span>
                    <div class="game-title">Reverse Think</div>
                </div>
                <div class="game-card" onclick="app.startGame('focus')">
                    <span class="game-icon">üéØ</span>
                    <div class="game-title">Focus Test</div>
                </div>
                <div class="game-card" onclick="app.startGame('decision')">
                    <span class="game-icon">‚öñÔ∏è</span>
                    <div class="game-title">Quick Decision</div>
                </div>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="game-screen" class="screen">
            <div class="timer-bar"><div id="timer-fill"></div></div>
            <div id="game-container">
                <!-- Game content injected here -->
            </div>
        </div>

        <!-- Result Screen -->
        <div id="result-screen" class="screen">
            <div class="iq-card">
                <h2 id="result-title">Game Over</h2>
                <div class="iq-value" id="result-score">0</div>
                <div class="iq-label">Points Earned</div>
            </div>
            <div id="skill-breakdown" style="margin-bottom: 20px; font-size: 0.9rem; color: var(--text-dim);"></div>
            <button class="btn-main" onclick="app.showDashboard()">Return to Hub</button>
        </div>
    </div>

    <div id="feedback"></div>

    <script>
        /** 
         * BRAINFORGE CORE ENGINE 
         * Handles state, scoring, and UI navigation
         */
        const app = {
            xp: parseInt(localStorage.getItem('bf_xp')) || 0,
            iq: parseInt(localStorage.getItem('bf_iq')) || 80,
            streak: 0,
            currentGame: null,
            difficulty: 1,
            gameID: "5709035",

            init() {
                this.updateUI();
                this.initAds();
            },

            initAds() {
                if (typeof UnityAds !== 'undefined') {
                    UnityAds.initialize(this.gameID, false);
                }
            },

            showAd() {
                console.log("Showing Unity Ad...");
                if (typeof UnityAds !== 'undefined' && UnityAds.isReady()) {
                    UnityAds.show();
                }
            },

            updateUI() {
                document.getElementById('xp-val').innerText = this.xp;
                document.getElementById('iq-display').innerText = this.iq;
                document.getElementById('rank-display').innerText = this.getRank(this.iq);
                localStorage.setItem('bf_xp', this.xp);
                localStorage.setItem('bf_iq', this.iq);
            },

            getRank(iq) {
                if (iq < 90) return "Beginner";
                if (iq < 110) return "Thinker";
                if (iq < 125) return "Analyst";
                if (iq < 140) return "Genius";
                return "Mastermind";
            },

            showScreen(id) {
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                document.getElementById(id).classList.add('active');
            },

            showDashboard() {
                this.showScreen('dashboard');
                this.updateUI();
            },

            startGame(type) {
                this.showScreen('game-screen');
                document.getElementById('game-container').innerHTML = '';
                
                // Adaptive difficulty logic based on IQ
                this.difficulty = Math.floor(this.iq / 20); 
                
                switch(type) {
                    case 'math': this.currentGame = new MathRush(); break;
                    case 'memory': this.currentGame = new MemoryGrid(); break;
                    case 'pattern': this.currentGame = new PatternMaster(); break;
                    case 'logic': this.currentGame = new LogicLock(); break;
                    case 'odd': this.currentGame = new OddOneOut(); break;
                    case 'reverse': this.currentGame = new ReverseThinking(); break;
                    case 'focus': this.currentGame = new FocusTest(); break;
                    case 'decision': this.currentGame = new QuickDecision(); break;
                }
                this.currentGame.start();
            },

            finishGame(score, skillType) {
                const iqGain = Math.floor(score / 200);
                this.iq += iqGain;
                this.xp += score;
                
                document.getElementById('result-score').innerText = score;
                document.getElementById('skill-breakdown').innerText = `Your ${skillType} ability increased.`;
                this.showScreen('result-screen');
                
                // Trigger Unity Ad on finish
                this.showAd();
            },

            showFeedback(text, color) {
                const f = document.getElementById('feedback');
                f.innerText = text;
                f.style.color = color;
                f.style.animation = 'none';
                f.offsetHeight; /* trigger reflow */
                f.style.animation = 'pop 0.6s ease-out';
            }
        };

        /**
         * GAME 1: MENTAL MATH RUSH
         */
        class MathRush {
            constructor() {
                this.score = 0;
                this.timeLeft = 30;
                this.timer = null;
                this.skill = "Processing Speed";
            }

            start() {
                this.nextQuestion();
                this.timer = setInterval(() => {
                    this.timeLeft -= 0.1;
                    document.getElementById('timer-fill').style.width = (this.timeLeft / 30 * 100) + '%';
                    if (this.timeLeft <= 0) this.end();
                }, 100);
            }

            nextQuestion() {
                const container = document.getElementById('game-container');
                const a = Math.floor(Math.random() * (10 * app.difficulty)) + 2;
                const b = Math.floor(Math.random() * (10 * app.difficulty)) + 2;
                const ops = ['+', '-', '√ó'];
                const op = ops[Math.floor(Math.random() * ops.length)];
                let ans;
                if (op === '+') ans = a + b;
                if (op === '-') ans = a - b;
                if (op === '√ó') ans = a * b;

                const choices = [ans, ans + 2, ans - 2, ans + 5].sort(() => Math.random() - 0.5);

                container.innerHTML = `
                    <div class="question-area"><h1>${a} ${op} ${b} = ?</h1></div>
                    <div style="width:100%">${choices.map(c => `<button class="choice-btn" onclick="app.currentGame.check(${c}, ${ans})">${c}</button>`).join('')}</div>
                `;
            }

            check(guess, correct) {
                if (guess === correct) {
                    this.score += 100;
                    app.showFeedback('+100', 'var(--accent)');
                    this.nextQuestion();
                } else {
                    this.timeLeft -= 3;
                    app.showFeedback('WRONG', 'var(--danger)');
                }
            }

            end() {
                clearInterval(this.timer);
                app.finishGame(this.score, this.skill);
            }
        }

        /**
         * GAME 2: MEMORY GRID
         */
        class MemoryGrid {
            constructor() {
                this.size = Math.min(Math.max(3, Math.floor(app.difficulty / 1.5)), 6);
                this.score = 0;
                this.skill = "Working Memory";
                this.pattern = [];
                this.userPattern = [];
                this.canTap = false;
            }

            start() {
                this.generateLevel();
            }

            generateLevel() {
                const container = document.getElementById('game-container');
                container.innerHTML = `<div class="question-area"><h3>Memorize the pattern</h3></div><div id="grid" class="grid-container" style="grid-template-columns: repeat(${this.size}, 1fr); width: 300px;"></div>`;
                const grid = document.getElementById('grid');
                
                for(let i=0; i < this.size * this.size; i++) {
                    const tile = document.createElement('div');
                    tile.className = 'grid-tile';
                    tile.id = `tile-${i}`;
                    tile.onclick = () => this.handleTap(i);
                    grid.appendChild(tile);
                }

                this.pattern = [];
                this.userPattern = [];
                const count = this.size + 1;
                while(this.pattern.length < count) {
                    let r = Math.floor(Math.random() * (this.size * this.size));
                    if(!this.pattern.includes(r)) this.pattern.push(r);
                }

                // Show flash
                setTimeout(() => {
                    this.pattern.forEach(idx => document.getElementById(`tile-${idx}`).classList.add('active'));
                    setTimeout(() => {
                        this.pattern.forEach(idx => document.getElementById(`tile-${idx}`).classList.remove('active'));
                        this.canTap = true;
                    }, 1200);
                }, 500);
            }

            handleTap(idx) {
                if(!this.canTap) return;
                const tile = document.getElementById(`tile-${idx}`);
                
                if(this.pattern.includes(idx)) {
                    tile.classList.add('correct');
                    if(!this.userPattern.includes(idx)) {
                        this.userPattern.push(idx);
                        if(this.userPattern.length === this.pattern.length) {
                            this.score += 500;
                            this.size = Math.min(this.size + 1, 7);
                            setTimeout(() => this.generateLevel(), 500);
                        }
                    }
                } else {
                    tile.classList.add('wrong');
                    this.canTap = false;
                    setTimeout(() => app.finishGame(this.score, this.skill), 1000);
                }
            }
        }

        /**
         * GAME 3: LOGIC LOCK
         */
        class LogicLock {
            constructor() {
                this.score = 0;
                this.skill = "Logical Reasoning";
                this.timeLeft = 45;
            }

            start() {
                this.timer = setInterval(() => {
                    this.timeLeft -= 1;
                    document.getElementById('timer-fill').style.width = (this.timeLeft / 45 * 100) + '%';
                    if (this.timeLeft <= 0) this.end();
                }, 1000);
                this.next();
            }

            next() {
                const num = Math.floor(Math.random() * 20) + 1;
                const container = document.getElementById('game-container');
                const clues = [];
                
                if (num % 2 === 0) clues.push("Number is Even"); else clues.push("Number is Odd");
                if (num > 10) clues.push("Greater than 10"); else clues.push("10 or Less");
                if (num % 3 === 0) clues.push("Divisible by 3"); else clues.push("Not divisible by 3");

                const choices = [num, num + 1, num - 2, Math.floor(Math.random() * 20)].sort(() => Math.random() - 0.5);

                container.innerHTML = `
                    <div class="question-area"><h3>Unlock the code:</h3><ul style="list-style:none; margin-top:10px;">${clues.map(c => `<li>‚Ä¢ ${c}</li>`).join('')}</ul></div>
                    <div style="width:100%">${[...new Set(choices)].map(c => `<button class="choice-btn" onclick="app.currentGame.check(${c}, ${num})">${c}</button>`).join('')}</div>
                `;
            }

            check(g, c) {
                if(g === c) { this.score += 300; this.next(); }
                else { this.timeLeft -= 5; app.showFeedback('LOCKED', 'red'); }
            }

            end() { clearInterval(this.timer); app.finishGame(this.score, this.skill); }
        }

        /**
         * GAME 4: REVERSE THINKING
         */
        class ReverseThinking {
            constructor() {
                this.score = 0;
                this.skill = "Cognitive Flexibility";
                this.timeLeft = 30;
            }

            start() {
                this.timer = setInterval(() => {
                    this.timeLeft -= 0.1;
                    document.getElementById('timer-fill').style.width = (this.timeLeft / 30 * 100) + '%';
                    if (this.timeLeft <= 0) this.end();
                }, 100);
                this.next();
            }

            next() {
                const colors = ['Red', 'Blue', 'Green', 'Yellow'];
                const displayColor = colors[Math.floor(Math.random()*colors.length)];
                const textColor = colors[Math.floor(Math.random()*colors.length)];
                const mode = Math.random() > 0.5 ? 'TEXT' : 'COLOR';

                const container = document.getElementById('game-container');
                container.innerHTML = `
                    <div class="question-area">
                        <p>Pick the ${mode === 'TEXT' ? 'COLOR of the word' : 'WORD itself'}</p>
                        <h1 style="color: ${displayColor.toLowerCase()}; font-size: 4rem;">${textColor}</h1>
                    </div>
                    <div style="width:100%; display:grid; grid-template-columns:1fr 1fr;">
                        ${colors.map(c => `<button class="choice-btn" onclick="app.currentGame.check('${c}', '${mode === 'TEXT' ? displayColor : textColor}')">${c}</button>`).join('')}
                    </div>
                `;
            }

            check(g, c) {
                if(g === c) { this.score += 150; this.next(); }
                else { this.timeLeft -= 2; }
            }

            end() { clearInterval(this.timer); app.finishGame(this.score, this.skill); }
        }

        /**
         * GAME 5: ODD ONE OUT
         */
        class OddOneOut {
            constructor() { this.score = 0; this.skill = "Classification"; }
            start() { this.next(); }
            next() {
                const types = [
                    { items: ['üçé', 'üçå', 'üçá', 'ü•¶'], odd: 'ü•¶', hint: 'Fruit vs Veg' },
                    { items: ['üöó', 'üö≤', '‚úàÔ∏è', 'üè†'], odd: 'üè†', hint: 'Vehicles' },
                    { items: ['2', '4', '8', '7'], odd: '7', hint: 'Even vs Odd' },
                    { items: ['üê∂', 'üê±', 'ü¶Å', 'üêü'], odd: 'üêü', hint: 'Mammal vs Fish' }
                ];
                const set = types[Math.floor(Math.random()*types.length)];
                const container = document.getElementById('game-container');
                container.innerHTML = `
                    <div class="question-area"><h3>Find the Odd One Out</h3></div>
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                        ${set.items.sort(()=>Math.random()-0.5).map(i => `<button class="choice-btn" style="font-size:3rem" onclick="app.currentGame.check('${i}', '${set.odd}')">${i}</button>`).join('')}
                    </div>
                `;
            }
            check(g, c) {
                if(g === c) { this.score += 400; this.next(); }
                else { app.finishGame(this.score, this.skill); }
            }
        }

        /**
         * GAME 6: PATTERN MASTER
         */
        class PatternMaster {
            constructor() { this.score = 0; this.skill = "Fluid Intelligence"; }
            start() { this.next(); }
            next() {
                const start = Math.floor(Math.random()*10);
                const step = Math.floor(Math.random()*5)+1;
                const pattern = [start, start+step, start+(step*2), '?'];
                const ans = start+(step*3);
                const container = document.getElementById('game-container');
                container.innerHTML = `
                    <div class="question-area"><h3>Complete the sequence:</h3><h1>${pattern.join(' , ')}</h1></div>
                    <div style="width:100%">${[ans, ans+step, ans-1, ans+2].sort(()=>Math.random()-0.5).map(c => `<button class="choice-btn" onclick="app.currentGame.check(${c}, ${ans})">${c}</button>`).join('')}</div>
                `;
            }
            check(g, c) {
                if(g === c) { this.score += 500; this.next(); }
                else { app.finishGame(this.score, this.skill); }
            }
        }

        /**
         * GAME 7: FOCUS TEST
         */
        class FocusTest {
            constructor() { this.score = 0; this.timeLeft = 20; this.skill = "Attention"; }
            start() {
                this.timer = setInterval(() => {
                    this.timeLeft -= 0.1;
                    if(this.timeLeft <= 0) this.end();
                    this.next();
                }, 800);
            }
            next() {
                const container = document.getElementById('game-container');
                const isTarget = Math.random() > 0.4;
                container.innerHTML = `
                    <div class="question-area"><h3>Tap only the TARGET</h3></div>
                    <div id="target" style="font-size:5rem; padding:40px; background:var(--card); border-radius:50%; width:150px; height:150px; display:flex; align-items:center; justify-content:center;" 
                        onclick="app.currentGame.hit(${isTarget})">
                        ${isTarget ? 'üéØ' : 'üí£'}
                    </div>
                `;
            }
            hit(isTarget) {
                if(isTarget) { this.score += 100; app.showFeedback('HIT!', 'cyan'); }
                else { this.score -= 200; app.showFeedback('BOOM', 'red'); }
            }
            end() { clearInterval(this.timer); app.finishGame(this.score, this.skill); }
        }

        /**
         * GAME 8: QUICK DECISION
         */
        class QuickDecision {
            constructor() { this.score = 0; this.skill = "Executive Function"; this.timeLeft = 20; }
            start() {
                this.timer = setInterval(() => {
                    this.timeLeft -= 0.1;
                    if(this.timeLeft <= 0) this.end();
                }, 100);
                this.next();
            }
            next() {
                const a = Math.floor(Math.random()*10);
                const b = Math.floor(Math.random()*10);
                const comp = Math.random() > 0.5 ? '>' : '<';
                const isTrue = comp === '>' ? a > b : a < b;
                const container = document.getElementById('game-container');
                container.innerHTML = `
                    <div class="question-area"><h1>${a} ${comp} ${b}</h1></div>
                    <div style="display:flex; width:100%; gap:10px;">
                        <button class="choice-btn" style="background:var(--accent)" onclick="app.currentGame.check(true, ${isTrue})">TRUE</button>
                        <button class="choice-btn" style="background:var(--danger)" onclick="app.currentGame.check(false, ${isTrue})">FALSE</button>
                    </div>
                `;
            }
            check(g, c) {
                if(g === c) { this.score += 100; this.next(); }
                else { this.timeLeft -= 2; this.next(); }
            }
            end() { clearInterval(this.timer); app.finishGame(this.score, this.skill); }
        }

        // Initialize App
        window.onload = () => app.init();
    </script>
</body>
</html>